# 12장 기본 인증 

이 장에서는 HTTP 인증과 기본 인증에 대해서 알아보려고 합니다.

## 12.1 인증

### 12.1.1 HTTP의 인증요구/응답 프레임워크

HTTP는 사용자 인증을 하는 데 사용하는 자체 인증요구/응답 프레임워크를 제공합니다.

웹 애플리케이션이 HTTP 요청 메시지를 받으면, 서버는 요청을 처리하는 대신에 개인 정보를 요구하는 ```인증 요구```로 응답할 수 있습니다.

### 12.1.2 인증 프로토콜과 헤더

HTTP에는 기본 인증과 다이제스트 인증이라는 공식적인 인증 프로토콜이 있습니다. 아래는 기본 인증과 관련된 표입니다.


| 단계 | 헤더 | 설명 | 메서드/상태 |
|---|:---:|:---:|:---:|
| `요청` | | 첫 번째 요청에는 인증 정보가 없음 | GET |
| `인증 요구` | WWW-Authenticate | 이름과 비밀번호를 제공하라는 의미로 401 상태 정보와 함께 요청을 반려 | 401 Unauthorized |
| `인증` | Authorization | 클라이언트는 Authorization헤더와 함께 요청을 다시 보냄 | GET |
| `성공` | Authentication-Info | Authentication-Info 에 인증 세션에 관한 추가 정보를 기술해서 응답 | 200 OK |

### 12.1.3 보안 영역

웹 서버는 보안 영역을 가지고, 보안 영역은 저마다 다른 사용자 권한을 요구합니다.

```realm```은 보호되는 영역을 설명하거나 보호의 범위를 알리는데 사용됩니다. 이는 어떤 공간에 사용자가 접근하려고 시도하는지를 알리기 위하여, "중간 단계의 사이트에 대한 접근"과 같거나 또는 비슷한 메시지가 될 수 있습니다.

참고: [HTTP 인증 - MDN](https://developer.mozilla.org/ko/docs/Web/HTTP/Authentication)


## 12.2 기본 인증

```기본 인증```은 가장 잘 알려진 HTTP 규약입니다. 기본 인증은 원래 HTTP/1.0에 기술되어 있었지만, HTTP 인증의 상세 내용을 다루는 RFC 2617 로 옮겨졌습니다.

브라우저는 사용자가 입력한 사용자 이름과 비밀번호를 Authorization 요청 헤더 안에 암호화해서 서버로 다시 보냅니다.

### 12.2.1 기본 인증의 예

<img width="768" alt="스크린샷 2021-01-05 오후 9 36 55" src="https://user-images.githubusercontent.com/29244798/103647170-33f42f00-4f9e-11eb-9fe0-22a7b93e29c8.png">

- 그림에서 사용자가 자신의 가족사진인 /family/jeff.jpg 요청
- 서버가 WWW-Authenticate 헤더와 함께 비밀번호를 요구하는 401 응답 반환
- 브라우저가 401 응답을 받고 인증을 요구하는 폼 노출
- 사용자가 사용자이름과 비밀번호를 입력하면 ```사용자이름:비밀번호``` 를 base-64 로 인코딩하고 Authorization 헤더에 담아서 전송
- 서버가 디코딩하여 값의 유효성 검사를 한 뒤, 문제가 없으면 HTTP 200 OK 메시지와 함께 요청받았던 문서 전송


### 12.2.2 Base-64 사용자 이름/비밀번호 인코딩

HTTP 기본 인증은 ```사용자 이름:비밀번호``` 를 base-64 인코딩 메서드를 사용해 인코딩을 합니다.

> base-64 인코딩이란?

base-64 인코딩은 바이너리, 텍스트, 국제 문자 데이터 문자열을 받아서 전송 가능한 문자인 알파벳으로 변환하기 위해 발명되어 8비트 바이트로 이루어져 있는 시퀀스를 6비트 덩어리의 시퀀스로 변환해줍니다.
각 6비트 조각은 대부분 문자, 숫자로 이루어진 64개의 문자 중에서 선택 되고, 전송 중에 원본 문자열이 변질될 걱정 없이 원격에서 디코딩이 가능합니다.


### 12.2.3 프락시 인증

회사 리소스 전체에 대해 통합적인 접근 제어 등 중개 프락시 서버를 통해 인증할 수 있습니다.
프락시 인증은 웹 서버의 인증과 헤더와 상태 코드만 다르고 절차는 같습니다.


| 웹 서버 | 프락시 서버 |
|---|:---:|
| 비인증 상태 코드 : 401 | 비인증 상태 코드 : 407 |
| WWW-Authenticate | Proxy-Authenticate |
| Authorization | Proxy-Authorization |
| Authentication-Info | Proxy-Authentication-Info |

### 12.2.1 기본 인증의 예

### 12.3 기본 인증의 보안 결함

대부분 기본 인증은 사용자 이름과 비밀번호를 악의적인 개인들에게 숨기려고 암호화된 데이터 전송 (SSL)과 함께 연계해서 사용합니다.

기본 인증을 사용해도 되는 케이스

- 개인화, 접근을 제어하는데 편리
- 다른 사람들이 보지 않기를 원하지만, 보더라도 치명적이지 않은 경우
- 호기심 많은 사용자가 우연이나 사고로 정보에 접근해서 보는 것을 예방

기본 인증의 결함

- 기본 인증은 사용자 이름과 비밀번호를 쉽게 디코딩할 수 있는 형식으로 네트워크에 전송하여 보안에 취약
- 재전송 공격을 막을 수 없음
- 메시지의 인증 헤더 외 다른 부분을 수정해서 트랜잭션의 본래 의도를 바꿔버리는 프락시, 중개자가 개입 가능
- 가짜 서버의 위장에 취약
