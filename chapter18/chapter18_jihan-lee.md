# HTTP 완벽가이드 정리
## 18장 웹 호스팅

> 콘텐츠 리소스를 저장, 중개, 관리하는 일을 통틀어 웹 호스팅이라 한다.   
   
### 18.1 호스팅 서비스

웹이 빠르게 대세가 되면서, 모든 사람이 웹 사이트를 원했지만, 냉난방 장치가 있는 서버실을 짓고   
도메인 이름을 등록하고 네트워크 대역폭을 구매할 기술과 시간을 가진 사람은 드물었다.   

그 시간을 절약하기 위해, 전문적으로 관리하는 웹 호스팅 서비스를 제공하는 여러 신사업이 만들어졌다.   
물리적인 장비 관리 부터 고객이 직접 콘텐츠를 제공할 수 있는 총체적 웹 호스팅까지 다양한 종류의 서비스들이 있다.   

#### 18.1.1 간단한 예: 전용 호스팅

죠의 컴퓨터가게 온라인과 메리의 골동품 경매는 꽤 큰 웹 사이트이다.   
둘은 직접 자체 서버를 구매하고 서버 소프트웨어를 직접 유지보수 하는 대신, 아이린의 ISP가 제공하는   
전용 웹 호스팅 서비스에 가입한다.   

죠와 아이린은 서로 다른 별개의 전용 서버를 아이린의 ISP에서 구한다.    
만약 메리의 골동품 샵이 유명해지면 아이린의 ISP는 추가적인 서버를 즉시 제공해줄 수 있다.   
   
---

### 18.2 가상 호스팅

많은 웹 호스팅 업자는 컴퓨터 한 대를 여러 고객이 공유하게 해서 저렴한 웹 호스팅 서비스를 제공한다.   
이를 **공유 호스팅 또는 가상 호스팅**이라 부른다.   

#### 18.2.1 호스트 정보가 없는 가상 서버 요청

* HTTP/1.0 명세는 공용 웹 서버가 호스팅하고 있는 가상 웹 사이트에 누가 접근하고 있는지 식별하는 기능을   
  제공하지 않는다.   
* 웹 서버는 사용자가 어떤 웹 사이트로 접근하려는지 아는데 필요한 정보가 충분하지 않다.   
* 여러 요청이 (서로 다른 웹 사이트에) 완전히 다른 문서를 요청해도, 요청 자체는 똑같이 생겼다.   
  * 웹 사이트 호스트 정보가 요청에서 제거되기 때문에 문제 발생   

#### 18.2.2 가상 호스팅 동작하게 하기

호스트 정보를 HTTP 요청 명세에 넣지 않은 것은, 각 웹 서버가 정확히 한 웹 사이트만 호스팅할 것이라고   
잘못 예측한 HTTP 명세의 실수였다.   

이러한 문제를 해결하기 위한 네 가지 기술이 나타났다.   

* **URL 경로를 통한 가상 호스팅**   
  * 서버가 어떤 사이트를 요청하는 것인지 알 수 있게 URL에 특별한 경로 컴포넌트 추가   
    * 예) ```GET /joe/index.html``` , ```GET /mary/index.html```    
  * 일반적으로, URL 기반의 가상 호스팅은 좋지 않은 방법이라 거의 사용하지 않음
   
* **포트번호를 통한 가상 호스팅**   
  * 각 사이트에 다른 포트번호를 할당하여, 분리된 웹 서버의 인스턴스가 요청을 처리   
  * 하지만 문제는 사용자가 URL에 비표준 포트를 쓰지 않고서도 리소스를 찾길 원한다.    

* **IP 주소를 통한 가상 호스팅**    
  * 가상 사이트에 별도의 IP 주소를 할당하고 모든 IP 주소를 장비 하나에 연결, 웹 서버는 IP 주소로 사이트 식별   
  * 서버는 HTTP 커넥션의 목적지 IP 주소를 보고 클라이언트가 어떤 웹 사이트에 연결하는지 알 수 있다.   
  * 규모가 아주 큰 호스팅 업자에게는 문제가 생김   
    * 장비의 IP 개수 제한으로 인한 여러 문제 발생   
    * 그럼에도 불구하고 널리 쓰이기는 함   
   
* **Host 헤더를 통한 가상 호스팅**   
  * HTTP/1.0 개선버전과 HTTP/1.1의 공식 버전에서 Host 요청 헤더를 정의    
    
#### 18.2.3 HTTP/1.1 Host 헤더

* **문법과 사용 방법**   
  * ``` Host = "Host" ":"호스트[":" 포트]```     
    Host 헤더에는 원본 URL에 있는 요청 리소스에 대한 인터넷 호스트와 포트번호를 기술   
  * 다음의 규칙이 있다.   
    * 포트가 없다면, 스킴의 기본 포트를 사용   
    * URL에 IP주소가 잆으면, Host 헤더는 같은 주소를 포함      
    * URL에 호스트 명이 있으면, Host 헤더는 같은 호스트 명을 포함   
    * URL에 호스트 명이 있으면, Host 헤더는 URL의 호스트 명이 가리키는 IP주소 포함하면 안 됨.   
      여러 개의 가상 사이트를 한 개의 IP 주소에 연결한 가상 호스트 서버에 문제   
    * 클라이언트가 특정 프락시 서버 사용한다면, Host 헤더에 프락시 서버가 아닌 원 서버의 호스트 명과 포트 기술   
    * 웹 클라이언트는 모든 요청 메시지에 Host 헤더 기술   
    * 웹 프락시는 요청을 전달하기 전 요청 메시지에 Host 헤더 추가   
    * HTTP/1.1 웹 서버는 Host 헤더 필드가 없는 HTTP/1.1 요청을 받으면 400 상태 코드로 응답     

* **Host 헤더 해석하기**   
  * HTTP 요청 메시지에 전체 URL이 기술되어 있으면, Host 헤더에 있는 값은 무시하고 URL을 사용   
  * HTTP 요청 메시지에 있는 URL에 호스트 명이 기술되어 있지 않고 요청에 Host 헤더가 있으면,   
    호스트 명과 포트를 Host 헤더에서 가져옴   
  * 앞의 두 경우에서 호스트를 결정할 수 없으면 클라이언트에 400 Bad Request 응답 반환   
   
* **Host 헤더와 프락시**    
  * 어떤 브라우저 버전은 부정확한 Host 헤더를 보낸다. (특히 프락시 사용하게 설정했을 경우)    
  * 프락시를 사용하도록 구성할 때 버전이 오래된 애플이나 포인트캐스트 클라이언트는 실수로 원 서버의 이름이   
    아닌 프락시의 이름을 Host 헤더에 담아 전송   
    
---

### 18.3 안정적인 웹 사이트 만들기

웹 사이트에 장애가 생기는 몇 가지 상황이 있다.   
* 서버 다운
* 트래픽 폭증   
* 네트워크 장애나 손실   
   
이러한 일반적인 문제를 예측하고 대응하는 몇 가지 방법을 소개한다.   

#### 18.3.1 미러링 된 서버 팜   

> 서버 팜은 서로 대신할 수 있고 식별할 수 있게 설정된 웹 서버들의 집합이다.   

* 서버팜의 서버에 있는 콘텐츠들은 한 곳에 문제가 생기면 다른 한 곳에서 대신 전달할 수 있게 미러링 할 수 있다.   
* 미러링 된 서버는 계층적인 관계에 있다. 한 서버(원본 콘텐츠를 갖고 있는)는 '콘텐츠의 원본 제작자'같이 행동한다. -> **마스터 원 서버**   
* 마스터 원 서버로부터 콘텐츠를 받은 미러링된 서버는 -> **복제 원 서버**   
* 서버 팜에 배포하는 간단한 방법   
  * 네트워크 스위츠를 사용해서 서버에 분산 요청을 보냄   
  * 서버에 호스팅 되고 있는 각 웹 사이트의 IP 주소는 스위치의 IP 주소    
   
#### 18.3.2 콘텐츠 분산 네트워크

콘텐츠 분산 네트워크(CDN)는 특정 콘텐츠의 분산을 목적으로 하는 단순한 네트워크이다.   
네트워크의 노드는 서버, 대리 서버, 혹은 프락시 서버가 될 수 있다.   
   
#### 18.3.3 CDN의 대리 캐시   

* 대리 캐시는 복제 원 서버를 대신해 사용될 수 있다.    
* 리버스 프락시라고도 불리는 대리 서버는 미러링 된 웹 서버처럼 콘텐츠에 대한 요청을 받는다.   
  * 특정 원 서버 집합을 대신해 요청을 받는다.   
* 대리 서버와 미러링 된 서버의 차이점   
  * 대리 서버는 수요에 따라서 동작 -> 원 서버의 전체 콘텐츠를 복사하지는 않음   
  * 대리 서버의 캐시에 콘텐츠가 분산되는 방식은 그들이 받는 요청에 따라 달라진다.   
    
#### 18.3.4 CDN의 프락시 캐시

* 대리 서버와 달리 전통적 프락시 캐시는 어떤 웹 서버의 요청이든지 다 받을 수 있다.   
* 대리 서버를 사용하면, 프락시 캐시의 콘텐츠는 요청이 있을 때만 저장되고 원본 서버 콘텐츠를 정확히   
  복제한다는 보장이 없다.   
* 어떤 프락시는 요청을 많이 받는 콘텐츠를 미리 로딩하기도 한다.   
* 요청이 있을 때만 저장하는 프락시 캐시는 조금 다른 방식으로 동작   
  * 레이어2 또는 레이어3 장비가 중간에서 웹 트래픽을 가로채 처리하기도 함    
  * 가로채기 설정은, 클라이언트와 서버 사이의 모든 HTTP 요청이 물리적으로 캐시를 거치게 네트워크 설정을   
    할 수 있는지에 따라 달라짐   
    