## 2장 URL과 리소스

HTTP 완벽 가이드 책을 읽고 이해한 내용을 정리한 글입니다.

---

URL(Uniform Resource Locator)은 리소스를 가리키는 표준이름입니다. URL은 정보 일부를 가리키고 어디에 있고 어떻게 접근할 수 있는지 알려줍니다.

이 장에서는 다음과 같은 것들을 다룹니다.

- URL 문법, 여러 URL 컴포넌트가 어떤 의미를 가지며 무엇을 수행하는지
- 여러 웹 클라이언트가 지원하는 상대 URL 과 확장 URL 같은 단축 URL 에 대해서
- URL의 인코딩과 문자 규칙
- 여러 인터넷 정보 시스템에 적용되는 공통 URL 스킴
- 기존 이름은 유지하면서 객체들을 다른 장소로 옮기는 것을 가능하게 해주는 URN 을 포함한 URL 의 미래

### 2.1 인터넷의 리소스 탐색하기

#### URL의 정의

```URL```은 브라우저가 정보를 찾는데 필요한 리소스의 위치를 가리키며, 수십억 개의 리소스를 찾고 사용하며 공유 할 수 있습니다. 사용자가 HTTP 및 다른 프로토콜을 통해 접근할 수 있습니다. URL 은 ```통합 자원 식별자 혹은 URI```라고 불리는 더 일반화된 부류의 부분집합입니다. URI는 두 가지 부분집합인 URL, URN으로 구성되어 있으며 HTTP 명세에서는 URI를 더 일반화된 개념의 리소스 식별자로 사용합니다.

1장에서 공부했던 것처럼 URL은 ```스킴://서버위치/경로```구조로 구성이 되어있고 URL 은 HTTP 프로토콜이 아닌 다른 가용한 프로토콜을 사용할 수도 있습니다.

- mailto:psujin831@gmail.com
- ftp://ftp.lots-o-books.com/pub/deep-dive-http-list.md
- rtsp://...

URL은 모든 사람이 같은 방식으로 이름을 사용하여 리소스를 찾을 수 있도록, 단일 방식의 작명 규칙을 가진 것입니다. 하지만 처음부터 일관된 명명 방식이 있었던 것은 아닙니다.


### 2.1.1 URL이 있기 전 암흑의 시대

### 2.2 URL 문법

URL로 인터넷상의 모든 리소스를 찾을 수 있지만, 그 리소스들은 다른 스킴을 통해 접근할 수 있고 URL 문법은 스킴에 따라서 달라집니다.

대부분의 URL 스킴의 문법은 일반적으로 9개 부분으로 나뉩니다.

```<스킴>://<사용자 이름>:<비밀번호>@<호스트>:<포트>/<경로>;<파라미터>?<질의>#<프래그먼트>```

| 컴포넌트 | 설명 | 기본값 |
|---|:---:|---:|
| `스킴` | 어떤 프로토콜을 사용하여 서버에 접근해야 하는지에 대한 정의 | `없음` |
| `사용자 이름` | 스킴에 따라 사용자 이름을 필요로 하는 경우가 있음 | `anonymous` |
| `비밀번호` | 사용자의 비밀번호 | `<이메일 주소>` |
| `호스트` | 리소스를 호스팅하는 서버의 호스트 명이나 IP 주소 | `없음` |
| `포트` | 리소스를 호스팅하는 서버가 열어놓은 포트번호. 대부분의 스킴이 기본 포트를 가지고 있음. (HTTP는 기본 80) | `스킴에 따라 다름` |
| `경로` | 경로 컴포넌트의 문법은 서버와 스킴에 따라 다름. | `없음` |
| `파라미터` | 특정 스킴들에서 입력 파라미터를 기술하는 용도로 사용. 이름/값을 쌍으로 가짐.  | `없음` |
| `질의` | 스킴에서 애플리케이션에 파라미터를 전달하는데 쓰임. URL의 끝에 "?"로 구분함. | `없음` |
| `프래그먼트` | 리소스의 조각이나 일부분을 가리키는 이름. URL이 특정 객체를 가리킬 경우에 프래그먼트 필드는 서버에 전달되지 않음. URL의 끝에서 "#" 문자로 구분. | `없음` |


### 2.2.1 스킴: 사용할 프로토콜

```스킴```은 주어진 리소스에 어떻게 접근하는지 알려주는 중요한 정보입니다. 어떤 프로토콜을 사용하여 요청해야 하는지 알려줍니다.

- 알파벳으로 시작
- URL의 나머지 부분들과 첫 번째 ":" 문자로 구분
- 대소문자를 가리지 않으므로 ```http://github.com/sujin-park```와 ```HTTP://github.com/sujin-park```는 동일


### 2.2.2 호스트와 포트

호스트와 포트는 리소스를 호스팅하고 있는 장비와 그 장비 내에서 리소스에 접근할 수 있는 서버가 어디에 있는지를 알려줍니다. 포트 컴포넌트는 서버가 열어놓은 네트워크 포트를 가리키고 내부적으로 TCP 프로토콜을 사용하는 HTTP는 기본 포트를 ```80```으로 사용합니다.

### 2.2.3 사용자 이름과 비밀번호

다양한 서버가 데이터에 접근을 허용하기 전에 사용자 이름과 비밀번호를 요구합니다. 예를 들어서 FTP 서버가 있습니다.

ftp://anonymous@ftp.prep.ai.mit.edu/pub/gnu
ftp://anonymous:my_password@ftp.prep.ai.mit.edu/pub/gnu

애플리케이션이 FTP와 같이 사용자 이름과 비밀번호를 요구하는 URL 스킴을 사용한다면, 값들이 없을 경우에 기본 사용자 이름과 비밀번호 값을 넣어놓습니다.
사용자 이름과 비밀번호를 기술하지 않고 FTP URL에 접근하면, 기본 사용자 이름은 anonymous, 비밀번호는 브라우저마다 가지고 있는 기본값을 사용합니다.

### 2.2.4 경로


```
http://www.github.com/sujin-park/deep-dive-http
```

URL의 경로는 ```/sujin-park/deep-dive-http``` 로 유닉스 파일 시스템의 파일 경로와 유사합니다. HTTP URL에서 경로 컴포넌트는 '/' 문자를 기준으로 경로가 나뉩니다. 각 경로는 자체만의 파라미터 컴포넌트를 가질 수 있습니다.

### 2.2.5 파라미터

URL을 사용하는 애플리케이션이 리소스에 접근하려면 프로토콜 파라미터가 필요합니다. 프로토콜 파라미터가 없으면 다른 한편에 있는 서버는 그 요청을 잘못 처리하거나 처리를 하지 않습니다.
URL의 파라미터는 이름/값 쌍의 리스트로 URL 나머지 부분들로부터 ";" 문자로 구분하여 URL에 기술합니다.

### 2.2.6 질의 문자열

```http://github.com/sujin-park/deep-dive-http/pulls?q=is%3Apr+is%3Aclosed```

URL의 질의 컴포넌트는 게이트웨이를 가리키는 URL의 경로 컴포넌트와 함께 전달하고 있습니다. 위의 예는 github.com/usjin-park/deep-dive-http 경로에서 ```is:pr is:closed```의 조건에 맞는 리소스를 가져오기 위한 질의 컴포넌트입니다.

사용하면 안 되는 특정 문자들을 제외하고는 질의 컴포넌트 포맷에 제약사항은 없고, 편의상 많은 게이트웨이가 '&'로 나뉜 '이름=값' 쌍 형식의 질의 문자열을 원합니다.

### 2.2.7 프래그먼트

리소스의 특정 부분을 가리킬 수 있도록, URL은 리소스 내의 조각을 가리킬 수 있는 프래그먼트 컴포넌트를 제공합니다. 예를 들어 URL은 HTML 문서에 있는 특정 이미지나 일부분을 가리킬 수 있습니다.

```http://www.joes-hardware.com/tools.html#drills```

위의 예는 drills 라는 프래그먼트는 웹 서버에 위치한 /tools.html 웹페이지의 일부를 가리킵니다. 그 부분을 drills 라고 기술합니다.

### 2.3 단축 URL

상대 URL은 리소스 안에 있는 리소스를 간결하게 기술하는데 사용할 수 있습니다. 많은 브라우저가 사용자가 기억하고 있는 URL 일부를 입력하면 나머지 부분을 자동으로 입력해주는 ```자동 확장```을 지원합니다.

### 2.3.1 상대 URL

URL은 상대 URL과 절대 URL 두가지로 나뉩니다. ```절대 URL```은 리소스를 접근하는데 필요한 모든 정보를 가지고 있지만, ```상대 URL```은 리소스에 접근하는데 필요한 모든 정보를 얻기 위해서는 기저(base) 라고 하는 다른 URL을 사용해야 합니다.

상대 URL 문법에 따르면 URL에 스킴, 호스트 그리고 다른 컴포넌트들을 모두 입력하지 않아도 리소스의 기저 URL 에서 알아낼 수 있습니다. URL을 처리하는 브라우저 같은 애플리케이션은 상대 URL 과 절대 URL 간에 상호 변환을 할 수 있어야 합니다.
아래는 예시입니다.

기저 URL: https://github.com/sujin-park/deep-dive-http

상대 URL : ./README.md

새로운 절대 URL : https://github.com/sujin-park/deep-dive-http/README.md

- 기저 URL
    - 변환 과정의 첫 단계는 기저 URL을 찾는 것입니다.
- 리소스에서 명시적 제공
    - 어떤 리소스들은 기저 URL을 가리키는 ```<BASE>```같은 HTML 태그를 기술하여 기저 URL을 명확하게 기술해주기도 합니다.
- 리소스를 포함하고 있는 기저 URL
    - 기저 URL이 명시되지 않은 리소스에 포함된 경우, 해당 리소스의 URL을 기저 URL로 사용할 수 있습니다.
- 기저 URL이 없는 경우
    - 보통 이런 경우는 절대 URL 만으로 이루어져 있다는 뜻이지만 불완전하거나 깨진 URL일 수도 있습니다.


**상대 참조 해석하기**

상대 URL을 절대 URL로 변환하기 위한 단계로 각각의 컴포넌트 조각으로 나누는 것입니다.
```URL 파싱```에 불과하지만, 컴포넌트 단위로 분리한다는 점에서 ```URL 분해하기```라고 부르기도 합니다.
URL들을 컴포넌트로 분해하고 나면 변환을 끝내기 위해 사용되는 알고리즘은 RFC 1808에 최초로 기술되었고, 그 이후 RFC 2396에 포함되었습니다.

### 2.3.2 URL 확장

어떤 브라우저들은 URL을 입력하고 있는 동안에 자동으로 URL을 확장합니다. ```확장```기능은 아래처럼 두 가지로 나뉩니다.

**호스트 확장**

호스트 명 확장 기능을 지원하는 브라우저는 단순한 휴리스틱만을 사용해서 입력한 호스트 명을 전체 호스트 명으로 확장합니다.
주소 입력란에 ```naver```를 입력하면, 브라우저는 호스트 명에 자동으로 ```www``와 ```com```을 붙여서 **www.naver.com**으로 확장합니다. 단어를 포함한 사이트를 찾지 못하면 몇 가지의 URL을 추가로 제시합니다.


**히스토리 확장**

브라우저가 사용자가 방문했던 URL의 기록을 저장해 놓고, URL을 입력하면 입력된 URL의 앞글자들을 포함하는 완결된 형태의 URL들을 선택할 수 있게 옵션으로 제공합니다.
프락시를 사용할 경우 URL 자동확장 기능은 다르게 동작할 수 있다는 것을 유념해야 합니다.

### 2.4 안전하지 않은 문자

```안전한 전송```이란, 정보가 유실될 위험 없이 URL을 전송할 수 있다는 것을 의미합니다. URL 설계자들은 모든 인터넷 프로토콜로 URL이 전송되고 가독성도 있기를 바랬습니다. 따라서 출력이 되지 않거나 보이지 않는 문자를 이메일 프로그램에서 사용할 수 있다고 해서, 문자들이 변환될 수 있다 하더라도 URL에서 그런 문자들을 사용하는 것은 금지되었습니다.


### 2.4.1 URL 문자 집합

URL이 특정 이진 데이터를 포함해야 하는 경우가 있는데 지원하기 위해서 URL 설계자들은 URL에 이스케이프 문자열을 쓸 수 있게 설계 되었습니다. 이스케이프 문자열은 US-ASCII에서 사용이 금지된 문자들로, 특정 문자나 데이터를 인코딩할 수 있게 함으로써 이동성과 완성도를 높였습니다.


### 2.4.2 인코딩 체계

```인코딩```은 안전하지 않은 문자를 퍼센티지 기호 (%)로 시작해, ASCII 코드로 표현되는 두 개의 16진수 숫자로 이루어진 이스케이프 문자로 바꿉니다.
안전한 문자 집합을 이용하는 경우 표현의 한계를 넘기 위해, URL에 있는 안전하지 않은 문자들을 표현할 수 있는 인코딩 방식이 고안되었습니다.

### 2.4.3 문자 제한

URL 내에서 특별한 의미로 예약되어있는 문자들이 있습니다. 

| 문자 | 선점 및 제한 |
|---|:---:|
| `%` | 인코딩된 문자에 사용할 이스케이프 토큰 |
| `/` | 경로 컴포넌트에 있는 경로 세그먼트를 나누는 용도 |
| `.` | 경로 컴포넌트에서 선점 |
| `..` | 경로 컴포넌트에서 선점 |
| `#` | 프래그먼트의 구획 문자로 선점 |
| `?` | 질의 문자열의 구획 문자로 선점 |
| `;` | 파라미터의 구획 문자로 선점 |
| `:` | 스킴, 사용자 이름/비밀번호, 호스트/포트의 구획 문자 |


### 2.5 스킴의 바다

웹에서 쓰이는 일반 스킴들의 포맷에 대해서 알아보려고 합니다.

| 스킴 | 설명 |
|---|:---:|
| `http` | 사용자 이름이나 비밀번호가 없다는 것을 제외하고는, 일반 URL 포맷을 지키는 하이퍼텍스트 전송 프로토콜 스킴. 기본 포트는 80 ```http://<호스트>:<포트>/<경로>?<질의>#<프래그먼트>``` |
| `https` | http 스킴과 거의 동일하지만 다른 점은 HTTP의 커넥션 양 끝단에서 암호화하기 위해 SSL을 사용함. 기본 포트는 443 |
| `mailto` | 이메일 주소를 가리키는 스킴. 이메일은 다른 스킴과는 다르게 동작하기 때문에, mailto URL은 표준 URL과는 다른 포맷을 가짐. 인터넷 이메일 주소의 문법은 RFC 822에 기술되어 있음. ```mailto:<RFC-822-addr-spec>``` |


### 2.6 미래

URL은 모든 객체에 이름을 지을 수 있고, 새로운 포맷을 추가할 수 있는 강력한 도구이지만 리소스가 옮겨지면 URL을 더는 사용할 수 없다는 단점이 있습니다. 그리고 그 시점에 기존 URL이 가리키고 있던 객체를 찾을 방법이 없어집니다.
인터넷 기술 테스크 포스는 URN이라는 새로운 표준 작업에 착수합니다. ```지속 통합 자원 지시자 (Persistent uniform resource locators, PURL)``` 을 사용하면 URL로 URN 의 기능을 제공할 수 있습니다. 리소스의 실제 URL 목록을 관리하고 추적하는 리소스 위치 중개 서버를 두고, 해당 리소스를 우회적으로 제공해줍니다.