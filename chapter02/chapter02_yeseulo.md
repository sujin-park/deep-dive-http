# 02. URL과 리소스

* URL(Uniform Resource Locator)은 인터넷 리소스를 가리키는 표준이름이다.

## 2.1 인터넷의 리소스 탐색하기

* URL은 브라우저가 정보를 찾는데 필요한 리소스의 위치를 가리킨다.
  * 사용자는 브라우저에 URL을 입력하고 브라우저는 화면 뒤에서 사용자가  우너하는 리소스를 얻기 위해서 적절한 프로토콜을 사용하여 메시지를 전송한다.
* URN은 현재 그 리소스가 어디에 존재하든 상관없이 그 이름만으로 리소스를 식별하는데 비해, URL은 현재 그 리소스가 어디 있는지 설명해서 리소스를 식별한다.
* HTTP 명세에서는 URI를 더 일반화된 개념의 리소스 식별자로 사용하지만, 실제로 HTTP 어플리케이션은 URL을 URI의 한 부분으로 취급한다.
* `http://`<sup>1</sup> `yeseulo.kr`<sup>2</sup> `/projects/deep-dive-http.gif`<sup>3</sup>
  1) URL의 스킴. 스킴은 웹 클라이언트가 리소스에 어떻게 접근하는지 알려준다. 이 경우 HTTP 프로토콜을 사용한다.
  2) 서버의 위치(호스트). 웹 클라이언트가 리소스가 어디에 호스팅 되어 있는지 알려준다.
  3) 리소스의 경로. 서버에 존재하는 로컬 리소스들 중에서 요청받은 리소스가 무엇인지 알려준다.
* 대부분의 URL은 동일하게 `스킴://서버위치/경로` 구조로 이루어져 있다.

### 2.1.1 URL이 있기 전 암흑의 시대

* 웹과 URL이 있기 전에는 네트워크상의 데이터 접근을 위해 애플리케이션마다 다른 분류 방식을 사용했다.
* 오늘날 브라우저들은 이런 기능을 하나의 패키지에 담아놓았고 URL을 사용하면 하나의 인터페이스를 통해 일관된 방식으로 리소스에 접근할 수 있다.
* URL은 사용자와 브라우저에게 정보를 찾는데 필요한 모든 것을 제공하며, 원하는 리소스가 어디에 위치하고 어떻게 가져오는지 정의한다.

## 2.2 URL 문법

* 인터넷 상에서 URL로 리소스를 찾을 떄, HTTP, FTP, SMTP와 같은 다른 스킴을 통해 접근할 수 있고, URL 문법은 스킴에 따라 달라진다.
* 대부분 URL은 일반 URL 문법을 따르며, 다른 URL 스킴을 사용해도 형태와 문법이 유사하다.
* 대부분의 URL 스킴의 문법은 보통 9개 부분으로 나뉜다.
  `<스킴>://<사용자 이름>:<비밀번호>@<호스트>:<포트>/<경로>;<파라미터>?<질의>#<프래그먼트>`

### 2.2.1 스킴: 사용할 프로토콜

* URL을 해석하는 애플리케이션이 어떤 프로토콜을 사용하여 리소스를 요청해야 하는지 알려준다.
* 스킴 컴포넌트는 알파벳으로 시작해야 하고 URL의 나머지 부분들과 첫 번째 `:` 문자로 구분한다.
* 스킴명은 대소문자를 가리지 않는다.
* 기본값은 없다.

### 2.2.2 호스트와 포트

* 호스트는 리소스르르 가지고 있는 인터넷 상의 호스트 장비를 가리키며, 호스트 명이나 IP 주소로 제공한다. 기본값은 없다.
* 포트는 리소스를 호스탕하는 서버가 열어놓은 네트워크 포트번호다.
  * 많은 스킴이 기본 포트를 가진다. 내부적으로 TCP 프로토콜을 사용하는 HTTP는 기본 포트로 80을 사용한다.

### 2.2.3 사용자 이름과 비밀번호

* 몇몇 스킴은 리소스 접근을 위해 사용자 이름이 필요하다. 기본값 anonymous.
* 비밀번호는 사용자 이름에 콜론(:)으로 이어서 기술한다.
  * 기본값 <이메일 주소>: IE는 'IEUser', Chrome은 'chrome@example.com'

### 2.2.4 경로

* 경로 컴포넌트는 리소스가 서버의 어디에 있는지 알려준다.
* 경로 컴포넌트의 문법은 서버와 스킴에 따라 다르다.
* 계층적 파일 시스템 경로와 유사하며, HTTP의 경우 유닉스 파일 시스템의 파일 경로와 유사하게 이전 컴포넌트와 빗금(/)으로 구분한다.

### 2.2.5 파라미터

* 특정 스킴에서 정확한 요청을 하기 위해 필요한 입력 파라미터를 받는데 사용한다.
* 파라미터는 이름/값 쌍의 리스트로, URL의 나머지 부분과 세미콜론(;)으로 구분한다.
* 각 경로 조각은 자체 파라미터를 가질 수 있다.
  `http://yeseulo.kr/projects;art=true/index.html;frontend=true`

### 2.2.6 질의 문자열

* 스킴에서 애플리케이션(데이터베이스, 게시판, 검색엔진, 기타 인터넷 게이트웨이)에 파라미터를 전달하는데 사용한다.
* 질의 컴포넌트 작성의 공통 포맷은 없으며, URL의 끝에 ?로 구분한다.
* 편의상 많은 게이트웨이가 `&`로 나뉜 `이름=값` 쌍 형식의 질의 문자열을 원한다.
  `http://yeseulo.kr/projects?id=875&category=art`

### 2.2.7 프래그먼트

* 리소스를 더 작게 나눈 조각이나 일부분을 가리키는 이름이다.
* URL의 끝에서 `#` 문자로 구분한다.
* 일반적으로 TTP 서버는 객체 일부가 아닌 전체 단위로만 전송하기 때문에, URL이 특정 객체를 가리킬 경우 클라이언트느 서버에 프래그먼트를 전달하지 않는다. 브라우저가 서버에서 전체 리소스를 내려받은 후 프래그먼트를 사용해 원하는 리소스 일부를 보여준다.

## 2.3 단축 URL

### 2.3.1 상대 URL

* URL은 상대 URL과 절대 URL 두 가지로 나뉜다.
  * 절대 URL은 리소스 접근에 필요한 모든 정보를 가진다.
  * 상대 URL은 URL을 짧게 표기하는 방식이다. 모든 정보를 담고있지는 않아서 기저(base)라고 하는 다른 URL을 사용해야 한다.
* 상대 URL을 사용하면 리소스 집합(HTML 페이지 같은)을 쉽게 변경할 수 있고, 문서 집합 위치를 변경하더라도 새로운 기저 URL에 의해 해석되므로 잘 동작할 것이다.
* 상대 URL을 절대 URL로 변환하는 방법
  1. 기저 URL 찾기
      - 리소스에서 명시적으로 제공하는 것(HTML문서에서 <BASE> HTML을 기술)을 가져온다.
      - 해당 리소스의 URL을 기저 URL로 사용할 수 있다.
      - 기저 URL이 없는 경우도 있는데 절대 URL만으로 이루어져있거나 불완전하거나 깨진 URL일 수 있다.
  2. 상대 참조 해석하기
      - 상대 URL과 기저 URL을 각각의 컴포넌트 조각으로 나누고(URL 분해하기) 알고리즘을 통해 절대경로 형태로 변환한다.

### 2.3.2 URL 확장

* 어떤 브라우저는 URL을 입력한 다음이나 입력 중에 자동으로 URL을 확장하여 빠르게 입력하도록 도와준다.
* 호스트 명 확장
  * 단순 휴리스틱만을 사용해서 입력한 호스트 명을 전체 호스트 명으로 확장한다.
  * 주소창에 `yeseulo`를 입력하면 브라우저는 자동으로 `www.yeseulo.kr`로 변환한다.
  * 어떤 브라우저는 yeseulo란 단어를 포함한 사이트를 찾지 못하면 확장을 포기하기 전 몇 URL을 추가로 제시한다.
  * 효율적이지만 프락시와 같은 다른 HTTP 애플리케이션에 문제를 발생시킬 수도 있다 (6장 참고)
* 히스토리 확장
  * 과거 사용자가 방문했던 URL 기록을 저장해뒀다가, URL을 입력하면 그 URL의 앞 글자를 포함하는 완결된 형태의 URL을 선택하게 한다.

## 2.4 안전하지 않은 문자

* 어떤 인터넷 프로토콜을 통해서드느 안전하게 데이터를 전송할 수 있도록 URL을 설계하는 것으 중요하며, 안전한 전송이란 정보 유실의 위험 없이 URL을 전송할 수 있다는 것을 뜻한다.
* 상대적으로 작고 일반적으로 안전한 알파벳 문자만 포함하도록 하여 문자가 제거되는 것을 피한다.
  * SMTP 프로토콜은 특정 문자를 제거할 수도 있는 전송방식을 사용한다.
* 가독성을 위해 출력이 되지 않거나 보이지 않는 문자를 사용하지 않는다.
* 이진 데이터나 알파벳 외 문자도 포함할 수 있게 이스케이프 기능을 추가하여 안전하지 않는 문자를 안전한 문자로 인코딩하게 한다.

### 2.4.1 URL 문자 집합

* 컴퓨너 시스템 기본 문자 집합은 보통 영어 중심의 US-ASCII를 사용해왔다.
  * 7비트를 사용해 영문 자판 키 대부분과 몇몇 출력되지 않는 제어 문자 표현
  * 만들어진 지 오래되어 적은 수 문자만을 포함하여 유럽 언어, 비 라틴계 언어는 지원하지 않는다.
* URL이 특정 이진 데이터를 포함해야하는 경우 이스케이프 문자열을 통해 특정 문자나 데이터를 인코딩할 수 있게 하여 이동성과 완성도를 높였다.

### 2.4.2 인코딩 체계

* 인코딩은 안전하지 않은 문자를 퍼센티지 기호 `%`로 시작해, ASCII 코드로 표현되는 두 개의 16진수 숫자로 이루어진 이스케이프 문자로 바꾼다.
  * 빈 문자 -- 32 (0x20) : `http://yeseulo.kr/more%20projects.html`

### 2.4.3 문자 제한

* URL 내 예약된 문자로, 본래 목적과 다른 용도로 사용하려면 그 전에 반드시 인코딩을 해야한다.
  * `%`: 인코딩된 문자에 사용할 이스케이프 토큰
  * `/`: 경로 컴포넌트에 있는 경로 세그먼트 나눔
  * `.`: 경로 컴포넌트에서 선점
  * `..`: 경로 컴포넌트에서 선점
  * `#`: 프래그먼트 구획 문자
  * `?`: 질의 문자열의 구획 문자
  * `;`: 파라미터 구획 문자
  * `:`: 스킴, 사용자 이름/비밀번호, 호스트/포트 구획 문자
  * `$` `+`: 선점
  * `@` `&` `=`: 특정 스킴에서 특별한 의미가 있어서 선점
  * `{` `}` `|` `\` `∙` `~` `[` `]` `` ` ``: 게이트웨이와 같은 여러 전송 에이전트에서 불안전하게 다루기 때문에 제한
  * `<` `>` `"`: 안전하지 않음. 웹 문서에서 URL을 구분 지어 표시하듯 URL 범위 밖에서 역할이 있는 문자이므로 반드시 인코딩 해야함.
  * `0x00` - `0x1F`, `0x7F`: 제한됨. 이 16진수 범위에 속하는 문자는 인쇄되지 않는 US-ASCII 문자
  * \> `0x7F`: 제한됨. 이 16진수 범위에 속하는 문자는 7비트 US-ASCII 문자가 아님

### 2.4.4 좀 더 알아보기

* 어떤 전송 프로토콜에서는 제한 문자를 사용해도 별 문제가 없기도 하지만 안전하지 않는 문자를 인코딩 하지 않는 것은 실수다.
* 어떤 애플리케이션에 어떤 URL을 보내든지 그 전에 클라이언트 애플리케이션에서 안전하지 않거나 제한된 문자를 변환하는 것이 좋다.
* 입력받은 URL에서 어떤 문자를 인코딩해야 하는지 결정하는 데는 브라우저 같이 사용자로부터 최초로 URL을 입력받는 애플리케이션에서 하는 것이 적절하다.
* 보통 URL을 해석하는 애플리케이션은 그를 처리하기 전에 URL을 디코드해야 한다.
* 스킴 같은 몇몇 URL컴포넌트는 쉽게 알아볼 수 있어야하고 알파벳 문자로 시작해야 한다.

## 2.5 스킴의 바다

* https: http 스킴과 거의 같다. HTTP 커넥션의 양 끝단에서 암호화하기 위해 넷스케이프에서 개발한 보안 소켓 계층(Secure Sockets Layer, SSL)을 사용한다는 것 뿐이다. 기본 포트는 443.
  `https://<호스트>:<포트>/<경로>?<질의>#<프래그먼트>`
* mailto: mailto URL은 이메일 주소를 가리킨다. 이메일은 다른 스킴과 다르게 동작하기 때문에 mailto URL은 표준 URL과 다른 포맷이다. 인터넷 이메일 주소의 문법은 RFC 822에 기술되어 있다.
  `mailto:<RFC-882-addr-spec>`
* ftp: 파일 전송 프로토콜(File Transfer Protocol) URL은 FTP 서버에 있는 파일을 내려받거나 올리고, FTP서버의 디렉터리에 있는 콘텐츠 목록을 가져오는데 사용할 수 있다.
  `ftp://<사용자 이름>:<비밀번호>@<호스트>:<포트>/<경로>;<파라미터>`

## 2.6 미래

* 사실 URL은 주소이지 실제 이름은 아니다. URL은 특정 시점에 어떤 것이 위치한 곳을 알려준다.
* 리소스가 옮겨지면 URL을 더 사용할 수 없고, 그 시점에 기존 URL이 가리키고 있던 객체를 찾을 방법이 없다.
* 객체 위치와 상관 없이 그 객체를 가리키는 실제 객체의 이름을 사용하면 이런 문제를 예방할 수 있다. (URN)
* 지속 통합 자원 지시자 Persistent Uniform Resource Locators, PURL을 사용하면 URL로 URN의 기능을 제공할 수 있다. PURL은 리소스의 실제 URL 목록을 관리하고 추적하는 리소스 위치 중개 서버를 두고 해당 리소스를 우회적으로 제공한다.

### 2.6.1 지금이 아니면 언제?

* URL에서 URN으로 주소 체계를 바꾸는 것을 매우 큰 작업으로, 표준 제정에서부터 여러 HTTP 애플리케이션 수정을 위한 벤더들과의 합의도 필요하다. 이에 시간이 걸리므로 당분간 URL이 계속 사용될 것이다.

## 2.7 추가 정보

* [Naming and Addressing: URIs, URLs, ...](https://www.w3.org/Addressing/)